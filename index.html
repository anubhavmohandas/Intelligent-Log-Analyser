<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Intelligent Log Analyzer</title>
  <style>
    :root {
      --bg:#0b1220;
      --bg2:#0f1b31;
      --card:rgba(255,255,255,.06);
      --text:#e8eefc;
      --muted:#a8b3cf;
      --accent:#67e8f9;
      --line:rgba(255,255,255,.18);
    }
    html,body{
      margin:0;padding:0;
      background:linear-gradient(135deg,var(--bg),#0b1630 55%,var(--bg));
      color:var(--text);
      font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    .container{max-width:1200px;margin:0 auto;padding:24px}
    .center{text-align:center}
    .header-title{
      font-weight:800;font-size:36px;margin:8px 0;
      background:linear-gradient(90deg,#5cc8ff,#67e8f9);
      -webkit-background-clip:text;background-clip:text;color:transparent
    }
    .subtle{color:var(--muted)}
    .card{background:var(--card);backdrop-filter: blur(8px);border:1px solid var(--line);border-radius:14px;padding:18px}
    .grid{display:grid;gap:16px}
    .grid-3{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .grid-4{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
    .btn{
      display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;
      border:1px solid #2c7c3f;background:rgba(56,189,98,.15);color:#b7f7c4;cursor:pointer
    }
    .btn:hover{background:rgba(56,189,98,.22)}
    .btn-ghost{border:1px dashed var(--line);background:rgba(255,255,255,.08);cursor:pointer}
    .btn-ghost:hover{border-color:var(--accent);background:rgba(103,232,249,.12)}
    .filebox{
      display:flex;align-items:center;justify-content:center;height:180px;
      border:2px dashed var(--line);border-radius:14px
    }
    .filebox:hover{border-color:var(--accent);background:rgba(255,255,255,.04)}
    .muted{font-size:12px;color:var(--muted)}
    .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .stat{border:1px solid var(--line);border-radius:12px;padding:14px;background:rgba(255,255,255,.05)}
    .stat .num{font-weight:800;font-size:26px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    select{background:rgba(255,255,255,.06);border:1px solid var(--line);color:var(--text);padding:8px 10px;border-radius:8px}
    .result{border:2px solid var(--line);border-radius:12px;padding:14px;background:rgba(255,255,255,.05)}
    .result.alert{border-color:rgba(249,115,22,.5)}
    .tags{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:8px}
    .tag{font-size:12px;font-weight:700;border-radius:999px;padding:6px 10px;color:#fff}
    .mono{font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;color:#cbd5e1;background:rgba(0,0,0,.35);padding:10px;border-radius:8px;overflow:auto}
    .kv{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px}
    .kv .item{background:rgba(255,255,255,.06);border-radius:8px;padding:8px}
    .kv .k{font-size:11px;color:#94a3b8;text-transform:capitalize}
    .kv .v{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .badge{font-size:11px;padding:4px 8px;border-radius:8px;border:1px solid}
    .b-critical{background:#fee2e2;color:#991b1b;border-color:#fca5a5}
    .b-high{background:#ffedd5;color:#9a3412;border-color:#fdba74}
    .b-medium{background:#fef3c7;color:#92400e;border-color:#fde68a}
    .b-low{background:#dcfce7;color:#166534;border-color:#86efac}
  </style>
</head>
<body>
  <div class="container">
    <div class="center">
      <div style="font-size:48px">üõ°Ô∏è</div>
      <div class="header-title">Intelligent Log Analyzer</div>
      <div class="subtle">Upload any log file and get automatic categorization and threat analysis</div>
    </div>

    <!-- Upload -->
    <div class="card" style="margin-top:18px">
      <div class="row" style="margin-bottom:12px">
        <div style="display:flex;align-items:center;gap:8px;font-weight:600;font-size:18px">üì§ Upload Log File</div>
      </div>
      <label id="dropArea" class="filebox btn-ghost" for="fileInput" aria-label="Upload log file (click or drag and drop)">
        <div class="center">
          <div style="font-size:40px">üìÑ</div>
          <div><b>Click to upload</b> or drag and drop</div>
          <div class="muted" id="selectedName">Any log file (TXT, LOG, CSV)</div>
        </div>
      </label>
      <input id="fileInput" type="file" accept=".txt,.log,.csv" style="display:none" />

      <!-- Samples -->
      <div style="margin-top:16px">
        <div class="muted" style="margin-bottom:6px">Or try a sample log file:</div>
        <div class="grid grid-3">
          <button class="card btn-ghost" data-sample="netscreen" aria-label="Load Netscreen firewall sample">
            <div style="display:flex;align-items:center;gap:8px;color: whitesmoke;">
              <span style="font-size:22px">üõ°Ô∏è</span><span style="font-weight:700">Netscreen Firewall</span>
            </div>
            <div class="muted">Samples inspired by OSSEC docs</div>
          </button>

          <button class="card btn-ghost" data-sample="cisco_ios" aria-label="Load Cisco IOS sample">
            <div style="display:flex;align-items:center;gap:8px;color: whitesmoke">
              <span style="font-size:22px">üåê</span><span style="font-weight:700">Cisco IOS Logs</span>
            </div>
            <div class="muted">show logging output &amp; syslog</div>
          </button>

          <button class="card btn-ghost" data-sample="ibm_zos" aria-label="Load IBM z/OS sample">
            <div style="display:flex;align-items:center;gap:8px;color: whitesmoke">
              <span style="font-size:22px">üíª</span><span style="font-weight:700">IBM z/OS Logs</span>
            </div>
            <div class="muted">OPERLOG / SYSLOG examples</div>
          </button>
        </div>
      </div>
    </div>

    <!-- Results -->
    <div id="resultsWrap" style="display:none;margin-top:16px">
      <div class="card" style="margin-bottom:12px">
        <div class="row">
          <div>
            <div class="muted">Analyzing File</div>
            <div id="fileName" style="font-weight:700"></div>
          </div>
          <div class="center">
            <div class="header-title" id="totalEntries" style="font-size:28px"></div>
            <div class="subtle">Total Entries</div>
          </div>
        </div>
      </div>

      <div class="stats">
        <div class="stat"><div class="num" id="statCritical">0</div><div class="muted">Critical</div></div>
        <div class="stat"><div class="num" id="statHigh">0</div><div class="muted">High Risk</div></div>
        <div class="stat"><div class="num" id="statMedium">0</div><div class="muted">Medium Risk</div></div>
        <div class="stat"><div class="num" id="statAlerts">0</div><div class="muted">Alerts</div></div>
      </div>

      <div class="card" style="margin-top:14px">
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:10px">üìà <b>Event Categories</b></div>
        <div id="categoryGrid" class="grid grid-4"></div>
      </div>

      <div class="card" style="margin-top:14px">
        <div class="row">
          <div style="display:flex;align-items:center;gap:10px">
            <span>üîé</span>
            <label class="muted">Filter by Category:</label>
            <select id="filterSelect" aria-label="Filter results by category"></select>
          </div>
          <button id="exportBtn" class="btn" aria-label="Export results as CSV">‚¨áÔ∏è Export CSV</button>
        </div>
      </div>

      <div id="resultsList" style="margin-top:14px" class="grid"></div>
    </div>
  </div>

<script>
/* -------------------- Analysis Logic -------------------- */
const state = { uploadedFile:null, analysis:null, filterCategory:'all' };

const eventCategories = {
  'Login Attempts': { patterns:[/login|logon|authentication|signin|sign-in|auth/i,/failed.*password|invalid.*credentials|auth.*fail/i,/successful.*login|logged in|authentication.*success/i,/ssh|telnet|rdp|ftp.*login/i], icon:'üîê', color:'#3b82f6' },
  'Network Changes': { patterns:[/interface.*up|interface.*down|link.*up|link.*down/i,/route.*add|route.*del|routing.*change/i,/vlan.*config|port.*config|switch.*config/i,/network.*change|topology.*change/i], icon:'üåê', color:'#06b6d4' },
  'Firewall Actions': { patterns:[/deny|drop|block|reject|discard/i,/permit|allow|accept|pass/i,/firewall.*rule|acl|access.*list/i,/src=|dst=|proto=/i], icon:'üõ°Ô∏è', color:'#8b5cf6' },
  'Configuration Changes': { patterns:[/config.*change|configuration|configured from/i,/policy.*change|rule.*change|setting.*change/i,/admin|administrator|root|sudo/i,/modify|update|edit.*config/i], icon:'‚öôÔ∏è', color:'#eab308' },
  'System Events': { patterns:[/start|started|stop|stopped|restart|reboot/i,/service.*up|service.*down|daemon/i,/system.*error|kernel|crash|panic/i,/job.*start|job.*end|process/i], icon:'üíª', color:'#22c55e' },
  'Security Alerts': { patterns:[/attack|intrusion|breach|exploit|vulnerability/i,/malware|virus|trojan|backdoor|ransomware/i,/suspicious|anomaly|unusual|unauthorized/i,/scan|probe|flood|ddos/i], icon:'üö®', color:'#ef4444' },
  'Access Control': { patterns:[/permission|privilege|access.*denied|forbidden/i,/unauthorized|unauthenticated/i,/role.*change|group.*add|user.*add/i,/sudo|su|privilege.*escalation/i], icon:'üîí', color:'#f97316' },
  'Data Transfer': { patterns:[/transfer|upload|download|file.*transfer/i,/bytes.*sent|bytes.*received|traffic/i,/ftp|sftp|scp|http.*post/i,/data.*sent|data.*received/i], icon:'üì°', color:'#6366f1' },
  'Error Events': { patterns:[/error|fail|failure|fatal|critical/i,/exception|abort|abend|crash/i,/timeout|unreachable|unavailable/i,/corrupt|invalid|malformed/i], icon:'‚ùå', color:'#ef4444' },
  'Warning Events': { patterns:[/warn|warning|caution|alert/i,/threshold.*exceed|limit.*reach/i,/deprecat|obsolete/i,/retry|attempt/i], icon:'‚ö†Ô∏è', color:'#eab308' },
  'Port Activity': { patterns:[/port.*\d+|destination.*port|source.*port/i,/22|23|80|443|3389|445|3306|1433|5432/,/ssh.*port|rdp.*port|http.*port/i,/port.*scan|port.*probe/i], icon:'üîå', color:'#14b8a6' },
  'Session Management': { patterns:[/session.*start|session.*end|session.*expire/i,/connection.*establish|connection.*close/i,/timeout|idle|disconnect/i,/keepalive|heartbeat/i], icon:'üîó', color:'#ec4899' }
};

function categorizeLogEntry(line){
  const categories=[];
  for (const [name, cfg] of Object.entries(eventCategories)) {
    if (cfg.patterns.some(p => p.test(line))) categories.push(name);
  }
  return categories.length ? categories : ['Uncategorized'];
}

function extractParameters(line){
  const params={};
  const tsPatterns=[
    /(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})/,
    /([A-Z][a-z]{2}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2})/,
    /(\d{2}:\d{2}:\d{2})/,
    /(\d{2}\.\d{2}\.\d{2})/
  ];
  for (const pat of tsPatterns) {
    const m=line.match(pat);
    if (m && !params.timestamp) params.timestamp=m[1];
  }
  const ipPattern=/(?:src|source|from|client)[=:\s]+(\d{1,3}(?:\.\d{1,3}){3})|(\d{1,3}(?:\.\d{1,3}){3})(?=\s|:)/gi;
  const ips=[...line.matchAll(ipPattern)];
  if (ips.length) params.sourceIP = ips[0][1] || ips[0][2];

  const dstMatch=line.match(/(?:dst|destination|to|server)[=:\s]+(\d{1,3}(?:\.\d{1,3}){3})/i);
  if (dstMatch) params.destinationIP = dstMatch[1];

  const portMatch=[...line.matchAll(/(?:port|sport|dport)[=:\s]+(\d+)/gi)];
  if (portMatch.length) params.port = portMatch[0][1];

  const protoMatch=line.match(/(?:proto|protocol)[=:\s]+(\w+)/i);
  if (protoMatch) params.protocol = protoMatch[1];

  const actionMatch=line.match(/(deny|permit|allow|block|drop|accept|reject|fail|success|start|stop)/i);
  if (actionMatch) params.action = actionMatch[1];

  const userMatch=line.match(/(?:user|username|account)[=:\s]+(\S+)/i);
  if (userMatch) params.user = userMatch[1];

  const ifMatch=line.match(/(?:interface|int)[:\s]+(\S+)/i);
  if (ifMatch) params.interface = ifMatch[1];

  const sevMatch=line.match(/(?:severity|level|priority)[=:\s]+(\w+)|%[A-Z]+-(\d)-/i);
  if (sevMatch) params.severity = sevMatch[1] || sevMatch[2];

  return params;
}

function assessThreatLevel(categories,line){
  const highRisk = ['Security Alerts','Access Control','Error Events'];
  const medRisk  = ['Login Attempts','Firewall Actions','Port Activity'];
  const hasHigh = categories.some(c => highRisk.includes(c));
  const hasMed  = categories.some(c => medRisk.includes(c));

  if (/fail|deny|reject|block|error|unauthorized/i.test(line)) return hasHigh ? 'critical' : 'high';
  if (hasHigh) return 'high';
  if (hasMed)  return 'medium';
  return 'low';
}

function analyzeLogFile(text, fileName){
  const lines = text.split(/\r?\n/).filter(l => l && l.trim());
  const results=[], categoryStats={};
  lines.forEach((line,i)=>{
    const categories = categorizeLogEntry(line);
    const parameters = extractParameters(line);
    const threatLevel = assessThreatLevel(categories, line);
    categories.forEach(c => categoryStats[c] = (categoryStats[c]||0)+1);
    results.push({
      lineNumber:i+1,
      originalLog:line,
      categories, parameters, threatLevel,
      isAlert: (threatLevel==='critical'||threatLevel==='high')
    });
  });

  const stats = {
    total: results.length,
    alerts: results.filter(r => r.isAlert).length,
    critical: results.filter(r => r.threatLevel==='critical').length,
    high: results.filter(r => r.threatLevel==='high').length,
    medium: results.filter(r => r.threatLevel==='medium').length,
    categoryBreakdown: categoryStats,
    fileName
  };

  state.analysis = { results, stats };
  render();
}

function colorForCategory(cat){ const cfg=eventCategories[cat]; return cfg ? cfg.color : '#64748b'; }
function badgeClass(level){
  return level==='critical' ? 'badge b-critical'
       : level==='high'    ? 'badge b-high'
       : level==='medium'  ? 'badge b-medium'
       : 'badge b-low';
}

function render(){
  const wrap=document.getElementById('resultsWrap');
  if(!state.analysis){ wrap.style.display='none'; return; }
  wrap.style.display='block';

  const {stats, results} = state.analysis;
  document.getElementById('fileName').textContent = stats.fileName || 'Untitled';
  document.getElementById('totalEntries').textContent = stats.total;
  document.getElementById('statCritical').textContent = stats.critical;
  document.getElementById('statHigh').textContent = stats.high;
  document.getElementById('statMedium').textContent = stats.medium;
  document.getElementById('statAlerts').textContent = stats.alerts;

  // Category cards (dynamic)
  const catGrid = document.getElementById('categoryGrid');
  catGrid.innerHTML = '';
  Object.entries(stats.categoryBreakdown)
    .sort(([,a],[,b]) => b - a)
    .forEach(([category, count])=>{
      const cfg = eventCategories[category] || {icon:'üìã'};
      const div = document.createElement('div');
      div.className='card';
      div.innerHTML = `
        <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
          <span style="font-size:20px">${cfg.icon}</span>
          <span style="font-size:13px;font-weight:600">${category}</span>
        </div>
        <div style="font-size:22px;color:${colorForCategory(category)}">${count}</div>`;
      catGrid.appendChild(div);
    });

  // Filter (dynamic from detected categories)
  const sel = document.getElementById('filterSelect');
  sel.innerHTML = '';
  sel.add(new Option(`All Events (${results.length})`, 'all'));
  if (stats.alerts > 0) sel.add(new Option(`‚ö†Ô∏è Alerts Only (${stats.alerts})`, 'alerts'));
  Object.keys(stats.categoryBreakdown).forEach(cat=>{
    sel.add(new Option(`${(eventCategories[cat]||{}).icon||'üìã'} ${cat} (${stats.categoryBreakdown[cat]})`, cat));
  });
  sel.value = state.filterCategory;

  // Results list
  const list = document.getElementById('resultsList');
  list.innerHTML = '';
  const filtered = results.filter(r =>
    state.filterCategory === 'all' ? true
    : state.filterCategory === 'alerts' ? r.isAlert
    : r.categories.includes(state.filterCategory)
  );

  filtered.forEach(r=>{
    const card=document.createElement('div');
    card.className='result' + (r.isAlert ? ' alert' : '');
    const chips = `<span class="muted">Line ${r.lineNumber}</span>
                   <span class="${badgeClass(r.threatLevel)}">${r.threatLevel.toUpperCase()}</span>`;
    const cats = r.categories.map(c =>
      `<span class="tag" style="background:${colorForCategory(c)}">${(eventCategories[c]||{}).icon||'üìã'} ${c}</span>`
    ).join('');
    const kv = Object.entries(r.parameters).map(([k,v]) =>
      `<div class="item"><div class="k">${k}</div><div class="v">${v}</div></div>`
    ).join('');
    card.innerHTML = `
      <div class="row" style="margin-bottom:8px">
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">${chips}</div>
        ${r.isAlert ? '<div style="font-size:20px;color:#fb923c">‚ö†Ô∏è</div>' : ''}
      </div>
      <div class="tags">${cats}</div>
      <div class="mono">${escapeHtml(r.originalLog)}</div>
      ${kv ? `<div class="kv" style="margin-top:8px">${kv}</div>` : ''}`;
    list.appendChild(card);
  });
}

function escapeHtml(s){
  return String(s)
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;');
}

function exportCsv(){
  if(!state.analysis) return;
  const filtered = state.analysis.results.filter(r =>
    state.filterCategory === 'all' ? true
    : state.filterCategory === 'alerts' ? r.isAlert
    : r.categories.includes(state.filterCategory)
  );
  const rows = [
    ["Line","Threat Level","Categories","Parameters","Original Log"],
    ...filtered.map(r => [
      r.lineNumber,
      r.threatLevel,
      r.categories.join(';'),
      Object.entries(r.parameters).map(([k,v])=>`${k}:${v}`).join(';'),
      r.originalLog.replace(/"/g,'""')
    ])
  ];
  const csv = rows.map(row => row.map(c => `"${String(c)}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url  = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = `log_analysis_${Date.now()}.csv`; a.click();
  URL.revokeObjectURL(url);
}

/* -------------------- Sample Data -------------------- */
const samples = {
  netscreen: `Jun  1 22:02:12 ns5gt: NetScreen device_id=ns5gt [Root]system-notification-00002: Admin user "baby" logged in for Web(http) management (port 8080) from 1.2.3.4:2150
Jun  1 22:05:44 ns5gt: NetScreen device_id=ns5gt: Traffic denied: src=203.0.113.10/43521 dst=10.0.0.5/22 proto=tcp
Jun  1 22:06:03 ns5gt: NetScreen device_id=ns5gt: Alert message: suspicious port scan detected from 203.0.113.10 to 10.0.0.0/24
Jun  1 22:07:10 ns5gt: NetScreen device_id=ns5gt: Critical: CPU utilization high (95%)`,
  cisco_ios: `Router# show logging
Syslog logging: enabled (0 messages dropped, 0 overruns)
%LINK-3-UPDOWN: Interface GigabitEthernet0/1, changed state to up
%SYS-5-CONFIG_I: Configured from console by admin on vty0 (10.0.0.10)
%SPANTREE-5-TOPO_CHG: Topology Change detected on VLAN1`,
  ibm_zos: `OPERLOG 2021-01-26T03:33:18.065Z JOB12345 STARTED - CLASS=A USER=IBMUSER
OPERLOG 2021-01-26T03:33:25.410Z JOB12345 ENDED - RC=0000
SYSLOG  09:10:00 IEF403I BACKUP  STARTED - TIME=09.10.00
SYSLOG  09:12:14 IEC070I 209-220, IFG0554A, VOL=SYS001, DEV=3390, UNIT=SYSDA
SSH     09:14:54 Failed password for invalid user test from 203.0.113.10 port 54321 ssh2`
};

/* -------------------- Wiring -------------------- */
const fileInput = document.getElementById('fileInput');
fileInput.addEventListener('change', async (e)=>{
  const f = e.target.files[0]; if(!f) return;
  document.getElementById('selectedName').textContent = `Selected: ${f.name}`;
  const text = await f.text();
  state.uploadedFile = f;
  analyzeLogFile(text, f.name);
});

// Drag & drop (optional)
const dropArea = document.getElementById('dropArea');
['dragenter','dragover'].forEach(ev =>
  dropArea.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); dropArea.classList.add('drag'); })
);
['dragleave','drop'].forEach(ev =>
  dropArea.addEventListener(ev, (e)=>{ e.preventDefault(); e.stopPropagation(); dropArea.classList.remove('drag'); })
);
dropArea.addEventListener('drop', async (e)=>{
  const f = e.dataTransfer?.files?.[0]; if(!f) return;
  document.getElementById('selectedName').textContent = `Selected: ${f.name}`;
  const text = await f.text();
  state.uploadedFile = f;
  analyzeLogFile(text, f.name);
});

// Sample buttons
document.querySelectorAll('[data-sample]').forEach(btn =>
  btn.addEventListener('click', ()=>{
    const key = btn.getAttribute('data-sample');
    const content = samples[key];
    if (!content) return;
    analyzeLogFile(content, `${key}_sample.log`);
  })
);

// Filter + Export
document.getElementById('filterSelect').addEventListener('change', (e)=>{
  state.filterCategory = e.target.value;
  render();
});
document.getElementById('exportBtn').addEventListener('click', exportCsv);
</script>
</body>
</html>
